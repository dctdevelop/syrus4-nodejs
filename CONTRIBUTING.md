# Workflow

The entry point is located in src/syrus.ts where all the modules are imported and the public ones are exported.

all the other modules can be found on the src/ folder each module represent a different feature, hardware or tool inside ApexOS. there are other two modules that are being in used by the other ones and represents the entry point of the usage of ApexOS:

src/Utils.ts: where is exposed the utilities for working with the Syrus4 and the method OSExecute that allow execute apx-tools and other commands from the Syrus4 and return the data as json.

src/Redis.ts: which expose the multiple instance redis configuration that allows received the data using publish and subscribe of redis.

The release system follow the git, gitflow and github releases, all the release must have a version bumped on the package.json and being tagged.

The documentation is autogenerated using a plugin called 'jsdoc2md', to his plugin work properly the docs of the every exported function or constant must well document following jsdoc. README.hbs contains the template.

SDK is written on Typescript and its recommend to use all the features like types and interface to write an A1 SDK for the user. The output of the compiled files are on the dist folder including the `.js.map`

## Considerations

- versions are following semantic versioning

- Use npm run document for only build documentation

- Use npm run build to compile project to js and generates docs from code

- Each exportable module must be added to src/syru4.ts file and be exported from there

- Release workflow MUST follow git flow release steps.

- the test folder can be used for unit test. right now only contains some examples and output for manual test. Ideally extend this for being automated unit test that can improve the workflow.

- src/ECU.json contains a structured json with all the recognized PGN and metadata info, is hihly recommend extend with new ecu data whenever is possible this way developer can deal with the ECU in a easy way.

## Testing using a Syrus4 device

run `npm run build` to generate dist folder and docs
create your test on ./tests folder, and require the module that you want to test
Example:

```javascript
S4 = require("../dist/syrus4");
var last;
var counter = 0;
S4.GPS.watchPosition(
	pos => {
		counter++;
		console.log(counter);
		last = pos;
	},
	console.error,
	{
		accuracy: 50,
		bearing: 20,
		time: 30,
		distance: 50
	}
);
```

Upload the code on any location of the data storage from syrus4, rsync is good way to make this easily
run your test inside the folder
Example

```bash
   cd /data/downloads/syrus4-nodejs/tests
   node gps-test.js
```

- make sure the code works as expected.
- profit

- !important: pending improvement make this real unit test using test framework like [mochajs](https://mochajs.org/)

## Testing Syrus4 device and Syrus4-App in local development

in your package.json file modify your dependencies to look like this

```json
"dependencies": {
    ...
    "syrus4-nodejs": "file:../syrus4-nodejs"
    ...
}
```

- run `npm run build` to generate dist folder and docs
- run `npm install syrus4-nodejs` on your Sryus4 App
- build your application, produce zip and upload as an app on the Syrus4
- make sure the code works as expected.
- profit
